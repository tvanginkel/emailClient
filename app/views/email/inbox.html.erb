<html>

<head>
  <%= stylesheet_link_tag "application.css" %>
</head>

<body>
<%= render 'partials/sidebar' %>
<h1> Inbox </h1>

<div class="tab">
  <% @mailboxes.each do |mailbox| %>
    <button class="tablinks" onclick="selectTab(event, '<%= mailbox.name %>')" id='default-open'>
      <%= mailbox.name %></button>
  <% end %>
  <button style="color: green" id="add">+</button>
</div>

<% @mailboxes.each do |mailbox| %>
  <div id="<%= mailbox.name %>" class="tabcontent">
    <% get_emails(mailbox).each do |email| %>
      <div class="email">
        <% if mailbox.name == 'Sent' %>
          <p><b>To:</b> <%= email.to %></p>
        <% else %>
          <p><b>From:</b> <%= email.from %></p>
        <% end %>
        <div class="vl"></div>
        <p><%= email.subject %></p>

        <div class="dropdown">
          <button onclick="myFunction(<%=email.id %>)" class="dropbtn">...</button>
          <div id="<%= email.id %>" class="dropdown-content">
            <a style="color:red;" href="/email/delete_email?id=<%= email.id %>">Delete</a>
            <a href="#move ">Move to...</a>
          </div>
        </div>
      </div>
    <% end %>
  </div>
<% end %>

<div id="myModal" class="modal">
  <!-- Modal content -->
  <div class="modal-content">
    <button class="btn-close btn-close-white" aria-label="Close"></button>
    <%= form_with :url => '/email/inbox', :method => :post do |form| %>
      <%= form.text_field :name, class: "form-control", placeholder: "Inbox name", :required => true %>
      <br>
      <%= form.submit "Create inbox", class: "btn btn-primary" %>
    <% end %>
  </div>

</div>

<script>
    /* When the user clicks on the button,
    toggle between hiding and showing the dropdown content */
    function myFunction(id) {
        document.getElementById(id).classList.toggle("show");
    }

    // Close the dropdown if the user clicks outside of it
    window.onclick = function (event) {
        if (!event.target.matches('.dropbtn')) {
            var dropdowns = document.getElementsByClassName("dropdown-content");
            var i;
            for (i = 0; i < dropdowns.length; i++) {
                var openDropdown = dropdowns[i];
                if (openDropdown.classList.contains('show')) {
                    openDropdown.classList.remove('show');
                }
            }
        }
    }
    // Get the modal
    let modal = document.getElementById("myModal");

    // Get the button that opens the modal
    let btn = document.getElementById("add");

    // Get the <span> element that closes the modal
    let span = document.getElementsByClassName("btn-close")[0];

    // When the user clicks the button, open the modal
    btn.onclick = function () {
        modal.style.display = "block";
    }

    // When the user clicks on <span> (x), close the modal
    span.onclick = function () {
        modal.style.display = "none";
    }

    //TODO: Add script to file in javascript folder
    document.getElementById("default-open").click();

    // TODO: Change name of function
    function selectTab(evt, cityName) {
        var i, tabcontent, tablinks;
        tabcontent = document.getElementsByClassName("tabcontent");
        for (i = 0; i < tabcontent.length; i++) {
            tabcontent[i].style.display = "none";
        }
        tablinks = document.getElementsByClassName("tablinks");
        for (i = 0; i < tablinks.length; i++) {
            tablinks[i].className = tablinks[i].className.replace(" active", "");
        }
        document.getElementById(cityName).style.display = "block";
        evt.currentTarget.className += " active";
    }
</script>
</body>
</html>

